#include "qGLSoftwareUserAgreement.h"
#include <qeventloop.h>
#include <QDesktopWidget>
#include <qapplication.h>
#include <qGLLog.h>

SoftwareUserAgreement::SoftwareUserAgreement(QWidget* parent)
    : QWidget(parent)
{
    //Log* instance = Log::instance();
    //connect(this, &SoftwareUserAgreement::sig_infolog, instance, &Log::appendInfoLog);
    //获取屏幕大小和个数
    QDesktopWidget* desktop = QApplication::desktop();
    int screenWidth = desktop->width(); //包括两个屏幕的宽度
    int screenHeight = desktop->height();
    //获取可用桌面的大小
    QRect deskRect = desktop->availableGeometry();
    int actScreenWidth = deskRect.width(); //包括一个屏幕的宽度
    int actScreenHeight = deskRect.height();
    int screenCount = desktop->screenCount();

    //用户协议框
    edit = new QTextEdit(QStringLiteral("服务协议"));
    edit->setFixedSize(actScreenWidth / 2, actScreenHeight * 2 / 3);
    edit->setStyleSheet("background:rgb(230,230,230);font-size:14px;color:rgb(0,0,0)");
    edit->setReadOnly(true); //只读
    edit->setFrameShape(QFrame::NoFrame); //设置无边框
    edit->setHtml(userAgreementContent);

    //按钮
    btnAccept = new QPushButton(QStringLiteral("接受"));
    btnRefuse = new QPushButton(QStringLiteral("拒绝"));
    btnAccept->setFlat(true);//设置按钮为QLabel样式
    btnRefuse->setFlat(true);
    btnAccept->setStyleSheet("background-color:gray;border-radius:0px;font-size:16px;color:rgb(0,0,0)");
    btnRefuse->setStyleSheet("background-color:gray;border-radius:0px;font-size:16px;color:rgb(0,0,0)");

    //布局-按钮
    layoutBtn = new QHBoxLayout;
    layoutBtn->addWidget(btnAccept);
    layoutBtn->addWidget(btnRefuse);
    layoutBtn->setMargin(0);
    layoutBtn->setSpacing(0);

    //布局-按钮布局+用户协议框
    layoutV = new QVBoxLayout;
    layoutV->addStretch();
    layoutV->addWidget(edit);
    layoutV->addLayout(layoutBtn);
    layoutV->addStretch();
    layoutV->setMargin(0);
    layoutV->setSpacing(0);

    //主布局
    layoutH = new QHBoxLayout;
    layoutH->addStretch();
    layoutH->addLayout(layoutV);
    layoutH->addStretch();
    layoutH->setMargin(0);
    layoutH->setSpacing(0);
    setLayout(layoutH);

    setAttribute(Qt::WA_DeleteOnClose);

    connect(btnAccept, &QPushButton::clicked, this, [=]()
    {
        this->close();
        emit sig_infolog("用户同意了软件用户协议");
        emit sig_quitEventLoop();
    });

    connect(btnRefuse, &QPushButton::clicked, this, [=]()
    {
        emit sig_infolog("用户不同意了软件用户协议");
        this->close();
        QApplication::closeAllWindows();
    });
    //显示背景


    showFullScreen();
    emit sig_infolog("显示初次运行时的软件用户协议");

    QEventLoop loop;
    connect(this, &SoftwareUserAgreement::sig_quitEventLoop, &loop, &QEventLoop::quit);
    loop.exec();
}

SoftwareUserAgreement::~SoftwareUserAgreement()
{
  
}

QString SoftwareUserAgreement::userAgreementContent = QStringLiteral
( 
  "<h1 align='center'>服务协议</h1>"
  "<h2>1. 特别提示</h2>"
  "<h3>1.1</h3>"
  "术中操作监控软件运营方同意按照本协议的规定及其不时发布的操作规则向用户提供术中操作监控软件服务。为获得术中操作监控软件服务，术中操作监控软件服务使用人（以下称“用户”）需在认真阅读及独立思考的基础上认可、同意本协议的全部条款并按照页面上的提示完成全部的注册程序。实际使用术中操作监控软件服务（或在登录过程中，在“服务协议”和“隐私条款”上打钩）即表示用户完全接受本服务协议。如用户对本服务协议或协议的任何部分存有任何异议，应终止注册程序（或停止使用术中操作监控软件 服务）。"
  "<h3>1.2</h3>"
  "由于安全性的考虑，用户将不具有注册权利，运营方在提供软件时。将提供相应的账号和密码，用户可自行修改密码。同时，用户同意：<br/>"
  "1.2.1 用户应妥善保管术中操作监控软件帐号及密码。<br/>"
  "1.2.2 未经术中操作监控软件运营方同意，用户不得擅自买卖、转让、出租任何术中操作监控软件帐号。<br/>"
  "1.2.3 用户使用术中操作监控软件服务过程中，须对自身使用术中操作监控软件服务的行为，对任何由用户通过术中操作监控软件服务发布、公开的信息，及对由此产生的任何后果承担全部责任。"
  "<h3>1.3</h3>"
  "用户使用术中操作监控软件服务过程中，对自身使用术中操作监控软件服务的行为以及通过术中操作监控软件服务发布、公开的任何信息享有合法权利，承担相应法律责任。同时，用户同意：<br/>"
  "1.3.1术中操作监控软件运营方对术中操作监控软件内容（术中操作监控软件内容即指用户在术中操作监控软件上已发布的信息，例如文字、图片、视频、音频等）享有使用权。<br/>"
  "1.3.2 未经术中操作监控软件运营方事先书面许可，用户不得自行或授权、协助任何第三方非法抓取术中操作监控软件内容，“非法抓取”是指采用程序或者非正常浏览等技术手段获取内容数据的行为。"
  "<h3>1.4</h3>"
  "用户在使用术中操作监控软件服务过程中应当严格遵守术中操作监控软件运营方所发布的术中操作监控软件协议。<br/>"
  "未经术中操作监控软件运营方事先书面同意，任何用户不得以任何方式自行或委托任何第三方以违反上述规定的方式访问术中操作监控软件平台或收集任何术中操作监控软件内容。"
  "<h3>1.5</h3>"
  "在法律法规允许的范围内，用户同意并授权术中操作监控软件运营方就侵犯用户合法权益的行为（包括但不限于私自复制、使用、编辑、抄袭等行为）采取任何形式的法律行动，包括但不限于投诉、诉讼等必要的维权措施。"
  "<h3>1.6</h3>"
  "术中操作监控软件运营方有权直接将本服务或本协议项下权利义务委托给其关联公司或其他第三方公司进行运营、管理及履行，术中操作监控软件运营方无需就此向用户另行获取授权。术中操作监控软件运营方将竭尽避免前述委托或变更给用户使用术中操作监控软件服务造成的不便，术中操作监控软件运营方届时将尽量及时通过网站、平台、私信、邮件等方式进行通知。"
  "<h3>1.7</h3>"
  "为提高用户的术中操作监控软件服务使用感受和满意度，用户同意术中操作监控软件运营方可以对用户数据进行调查研究和分析，从而进一步优化术中操作监控软件服务。"
  "<h2>2. 服务内容</h2>"
  "<h3>2.1</h3>"
  "术中操作监控软件服务的具体内容由术中操作监控软件运营方根据实际情况提供，包括但不限于用户使用术中操作监控软件服务进行激光消融手术等，术中操作监控软件运营方有权对其提供的服务或产品形态进行升级或其他调整，并将及时告知用户。"
  "<h3>2.2</h3>"
  "用户理解，术中操作监控软件运营方仅提供与术中操作监控软件服务相关的技术服务，除此之外与相关网络服务有关的设备（如个人电脑、手机、及其他与接入互联网或移动网有关的装置）及所需的费用（如为接入互联网而支付的电话费及上网费、为使用移动网络而支付的手机费）均由用户自行负担。"
  "<h2>3. 服务变更、中断或终止</h2>"
  "<h3>3.1</h3>"
  "鉴于操作监控软件的特殊性（包括但不限于恶意的网络攻击等行为的存在及其他术中操作监控软件运营方无法控制的情形），用户同意术中操作监控软件运营方有权随时中断或终止部分或全部的术中操作监控软件服务（包括收费网络服务），若发生该等情形，术中操作监控软件运营方将尽可能及时通过网页公告、系统通知、私信、短信提醒或其他合理方式通知受到影响的用户。"
  "<h3>3.2</h3>"
  "用户理解，术中操作监控软件运营方需要定期或不定期地对提供术中操作监控软件服务的平台（如应用程序、数据库等）或相关的设备进行检修或者维护，如因此类情况而造成服务在合理时间内的中断，术中操作监控软件运营方无需为此承担任何责任，但术中操作监控软件运营方应尽可能事先进行通告。"
  "<h3>3.3</h3>"
  "如发生下列任何一种情形，术中操作监控软件运营方有权随时中断或终止向用户提供本协议项下的术中操作监控软件服务，而无需对用户或任何第三方承担任何责任，由此造成的损失由用户自行独立承担：<br/>"
  "3.3.1 用户提供的个人资料不真实；<br/>"
  "3.3.2 用户违反法律法规国家政策或本协议中规定的使用规则；<br/>"
  "3.3.3 用户在使用收费服务时未按规定为其所使用的收费服务支付相关服务费用；<br/>"
  "3.3.4 用户侵犯个人、企业事业单位或社会团体的合法权益，包括但不限于专利权、著作权、商标权，或姓名权、名称权、名誉权、荣誉权、肖像权、隐私权等；<br/>"
  "3.3.5 用户损害监管部门、国家机关及政府形象；<br/>"
  "3.3.6 用户以任何方式损害术中操作监控软件运营方及其关联公司的商誉或信誉等合法权益；<br/>"
  "3.3.7术中操作监控软件运营方有其他合理理由认为需要中断或终止向用户提供术中操作监控软件服务的。<br/>"
  "<h2>4. 使用规则</h2>"
  "<h3>4.1</h3>"
  "用户向运营商申请注册术中操作监控软件帐号，应当使用真实身份信息及个人资料，不得以虚假或冒用的居民身份信息、企业相关信息进行注册；若用户的个人资料有任何变动，用户应及时更新。<br/>"
  "未经相关权利人授权，用户不得以他人或其他组织机构名义向运营商申请注册术中操作监控软件帐号，亦不得使用引人误解的信息向运营商申请注册术中操作监控软件帐号，包括但不限于让人误认为该帐号与其他个人或机构组织存在关联关系的名称、头像或简介等。"
  "<h3>4.2</h3>"
  "用户知悉并同意，以下信息一经用户提交确认则无法更改，因内容瑕疵（包括但不限于错误，不完整、不满意等）所造成的损失及后果由用户独立承担：<br/>"
  "4.2.1术中操作监控软件运营方规定的确定后无法修改的帐号信息。<br/>"
  "<h3>4.3</h3>"
  "术中操作监控软件运营方将建立健全用户信息安全管理制度、落实技术安全防控措施。术中操作监控软件运营方将对用户使用术中操作监控软件服务过程中涉及的用户隐私内容加以保护。<br/>"
  "术中操作监控软件运营方建议用户自行不定期备份。<br/>"
  "<h3>4.4</h3>"
  "由于术中操作监控软件服务的存在前提是用户在向运营商申请申请开通术中操作监控软件服务的过程中所提供的帐号，用户不应将其帐号、密码转让或出借予他人使用。如用户发现其帐号或术中操作监控软件服务遭他人非法使用，应立即通知术中操作监控软件运营方。因黑客行为或用户的保管疏忽等非术中操作监控软件运营方原因导致帐号、密码及术中操作监控软件服务遭他人非法使用的，由用户自行承担相关责任。"
  "<h3>4.5</h3>"
  "用户同意术中操作监控软件运营方在提供术中操作监控软件服务过程中以各种方式投放各种商业性广告或其他任何类型的商业信息（包括但不限于在术中操作监控软件平台网站的任何页面上投放广告），并且，用户同意接受术中操作监控软件运营方通过电子邮件、私信或其他方式向用户发送商品促销或其他相关商业信息。"
  "<h3>4.6</h3>"
  "为了更好地促进信息分享及宣传推广，用户授权术中操作监控软件运营方可在术中操作监控软件及其关联产品和服务上使用术中操作监控软件内容，以及为宣传推广之目的将上述内容许可给第三方使用。用户对术中操作监控软件运营方及其关联公司的前述授权并不改变用户发布内容的所有权及知识产权归属，也并不影响用户行使其对发布内容的合法权利。"
  "<h3>4.7</h3>"
  "用户在使用术中操作监控软件服务过程中，必须遵循以下原则：<br/>"
  "4.7.1 不得违反中华人民共和国法律法规及相关国际条约或规则；<br/>"
  "4.7.2 不得违反与网络服务、术中操作监控软件服务有关的网络协议、规定、程序及行业规则；<br/>"
  "4.7.3 不得进行任何可能对互联网或移动网正常运转造成不利影响的行为；<br/>"
  "4.7.4<br/>"
  "不得上传、展示或传播任何不实虚假、冒充性的、骚扰性的、中伤性的、攻击性的、辱骂性的、恐吓性的、种族歧视性的、诽谤诋毁、泄露隐私、色情淫秽、恶意抄袭、暴力、血腥、自杀、自残的或其他任何非法的信息资料；<br/>"
  "4.7.5 不得侵犯任何个人、企业事业单位或社会团体的合法权益，包括但不限于专利权、著作权、商标权，或姓名权、名称权、名誉权、荣誉权、肖像权、隐私权等；<br/>"
  "4.7.6 不得以任何方式损害各级国家机关及政府形象；<br/>"
  "4.7.7 不得以任何方式损害术中操作监控软件运营方及其关联公司的商誉或信誉等合法权益；<br/>"
  "4.7.8 不得从事其他任何影响术中操作监控软件运营方正常运营、破坏术中操作监控软件经营模式或其他有害术中操作监控软件生态的行为；<br/>"
  "4.7.9 不得为其他任何非法目的而使用术中操作监控软件服务。<br/>"
  "<h3>4.8</h3>"
  "针对某些特定的术中操作监控软件服务的使用规则及说明，术中操作监控软件运营方通过各种方式（包括但不限于网页公告、系统通知、消息、短信提醒等）作出的任何声明、通知、警示等内容均视为本协议的一部分，用户如使用该等术中操作监控软件服务，视为用户同意该等声明、通知、警示的内容。<br/>"
  "<h3>4.9</h3>"
  "术中操作监控软件运营方有权对用户使用术中操作监控软件服务的行为及信息进行审查、监督及处理，包括但不限于用户信息（帐号信息、个人信息等）等范畴。"
  "<h2>5. 知识产权</h2>"
  "<h3>5.1</h3>"
  "术中操作监控软件运营方是术中操作监控软件平台和术中操作监控软件产品的所有权及知识产权权利人。"
  "<h3>5.2</h3>"
  "上述术中操作监控软件产品指的是术中操作监控软件运营方、术中操作监控软件运营方关联公司、或其授权主体等通过术中操作监控软件平台为用户提供的包括但不限于关系链拓展、便捷辅助工具、平台应用程序等功能、软件、服务等。"
  "<h3>5.3</h3>"
  "术中操作监控软件运营方是术中操作监控软件平台及术中操作监控软件产品中所有信息内容的所有权及知识产权权利人。前述信息内容包括但不限于程序代码、界面设计、版面框架、数据资料、帐号、文字、图片、图形、图表、音频、视频等，除按照法律法规规定应由相关权利人享有权利的内容以外。"
  "<h3>5.4</h3>"
  "用户在使用术中操作监控软件平台的过程中，可能会使用到由第三方开发的在术中操作监控软件平台运行的功能、软件或服务，用户除遵守本协议相关规定以外，还应遵守第三方相关规定，并尊重第三方权利人对其功能、软件、服务及其所包含内容的相关权利。"
  "<h3>5.5</h3>"
  "鉴于以上，用户理解并同意：<br/>"
  "5.5.1 未经术中操作监控软件运营方及相关权利人同意，用户不得对上述功能、软件、服务进行反向工程 （ reverse engineer ）、反向编译（ decompile ）或反汇编（ disassemble ）等；同时，不得将上述内容或资料在任何媒体直接或间接发布、播放、出于播放或发布目的而改写或再发行，或者用于其他任何目的；<br/>"
  "5.5.2</br>"
  "在尽商业上的合理努力的前提下，术中操作监控软件运营方并不就上述功能、软件、服务及其所包含内容的延误、不准确、错误、遗漏或由此产生的任何损害，以任何形式向用户或任何第三方承担任何责任；<br/>"
  "5.5.3术中操作监控软件运营方并不对上述任何由第三方提供的功能、软件、服务或内容进行任何保证性的、或连带性的承诺或担保，由此产生的任何纠纷、争议或损害，由用户与第三方自行解决，术中操作监控软件运营方不承担任何责任；<br/>"
  "5.5.4<br/>"
  "为更好地维护术中操作监控软件生态，术中操作监控软件运营方保留在任何时间内以任何方式处置上述由术中操作监控软件运营方享受所有权及知识产权的产品或内容，包括但不限于修订、屏蔽、删除或其他任何法律法规允许的处置方式。<br/>"
  "<h2>6. 隐私保护</h2>"
  "<h3>6.1</h3>"
  "保护用户隐私和其他个人信息是术中操作监控软件的一项基本政策，具体内容详见术中操作监控软件个人信息相关保护政策。"
  "<h2>7. 免责声明</h2>"
  "<h3>7.1</h3>"
  "用户在使用术中操作监控软件服务的过程中应遵守国家法律法规及政策规定，因其使用术中操作监控软件服务而产生的行为后果由用户自行承担。"
  "<h3>7.2</h3>"
  "用户通过术中操作监控软件服务发布的任何信息，及通过术中操作监控软件服务传递的任何观点不代表术中操作监控软件之立场，术中操作监控软件亦不对其完整性、真实性、准确性或可靠性负责。用户对于可能会在术中操作监控软件上接触到的非法的、非道德的、错误的或存在其他失宜之处的信息，及被错误归类或是带有欺骗性的发布内容，应自行做出判断。在任何情况下，因前述非正当信息而导致的任何损失或伤害，应由相关行为主体承担全部责任。"
  "<h3>7.3</h3>"
  "对于因不可抗力或术中操作监控软件运营方不能控制的原因造成的术中操作监控软件服务中断或其它缺陷,术中操作监控软件运营方不承担任何责任，但将尽力减少因此而给用户造成的损失和影响。"
  "<h3>7.4</h3>"
  "术中操作监控软件运营方对其向用户所提供的术中操作监控软件产品及服务依法承担相关责任，但法律另有规定或另有约定的除外。"
  "<h3>7.5</h3>"
  "用户知悉并同意，术中操作监控软件运营方可能会与第三方合作向用户提供产品并由第三方向用户提供该产品的升级、维护、客服等后续工作，由该等第三方对该产品的质量问题或其本身的原因导致的一切纠纷或用户损失承担责任，用户在此同意将向该第三方主张与此有关的一切权利和损失。"
  "<h3>7.7</h3>"
  "除另有约定外，术中操作监控软件运营方提供的产品或服务，如未标明使用期限、或者其标明的使用期限为“永久”、“无限期”或“无限制”的，则其使用期限为自用户开始使用该产品或服务至该产品或服务在术中操作监控软件下线之日为止。</br>"
  "<h2>8. 违约责任</h2>"
  "<h3>8.1</h3>"
  "如因术中操作监控软件运营方违反有关法律、法规或本协议项下的任何条款而给用户造成损失的，因此给用户造成的损害赔偿责任由术中操作监控软件运营方承担。"
  "<h3>8.2</h3>"
  "用户同意保障和维护术中操作监控软件运营方及其关联公司及其他用户的合法权益，如因用户违反有关法律、法规或本协议项下的任何条款而给术中操作监控软件运营方及其关联公司或任何其他任何第三方造成损失，用户同意承担由此造成的损害赔偿责任。"
  "<h3>8.3</h3>"
  "如术中操作监控软件运营方发现或收到第三方举报或投诉获知，用户存在或涉嫌违反本协议第 1 条（特别提示）、或第 4 条（使用规则）的，术中操作监控软件运营方或其授权主体有权依据其合理判断不经通知立即采取一切必要措施以减轻或消除用户行为造成的影响，并将尽可能在处理之后对用户进行通知。由此造成的损失及后果（包括但不限于错过推广时机、丧失营销收入等）由用户自行独立承担。"
  "<h3>8.4</h3>"
  "除本协议另有约定外，如术中操作监控软件运营方发现或收到第三方举报或投诉获知，用户存在或涉嫌违反本协议中约定的义务、保证、承诺或其他条款，用户应在术中操作监控软件运营方指定期限内予以纠正并消除影响；若用户未在前述时限内予以纠正的，术中操作监控软件运营方或其授权主体有权依据其合理判断立即采取一切必要措施以减轻或消除用户行为造成的影响，并将尽可能在处理之后对用户进行通知。由此造成的损失及后果（包括但不限于错过推广时机、丧失营销收入等）由用户自行独立承担。"
  "<h3>8.5</h3>"
  "本协议 8.3 、 8.4 中所述的“一切必要措施”包括但不限于以下一项或多项：<br/>"
  "8.5.1 变更、限制或禁止违规帐号部分或全部功能；<br/>"
  "8.5.2 暂停、限制或终止用户使用术中操作监控软件服务的权利；<br/>"
  "8.5.3 向有关监管部门或国家机关报告；<br/>"
  "8.5.4 其他术中操作监控软件运营方认为合理的措施。<br/>"
  "<h2>9. 协议修改</h2>"
  "<h3>9.1</h3>"
  "术中操作监控软件运营方有权随时修改本协议的任何条款，一旦本协议的内容发生变动，术中操作监控软件运营方将会在术中操作监控软件平台上公布修改之后的协议内容，术中操作监控软件运营方也可选择通过其他适当方式（比如邮件通知）向用户通知修改内容。"
  "<h3>9.2</h3>"
  "如果不同意术中操作监控软件运营方对本协议相关条款所做的修改，用户有权停止使用术中操作监控软件服务。如果用户继续使用术中操作监控软件服务，则视为用户接受术中操作监控软件运营方对本协议相关条款所做的修改。"
  "<h2>10. 通知送达</h2>"
  "<h3>10.1</h3>"
  "本协议项下术中操作监控软件运营方对于用户所有的通知均可通过网页公告、电子邮件、系统通知、术中操作监控软件管理帐号主动联系、私信、手机短信或常规的信件传送等方式进行；该等通知于发送之日视为已送达收件人。"
  "<h3>10.2</h3>"
  "用户对于术中操作监控软件运营方的通知应当通过术中操作监控软件运营方对外正式公布的通信地址、传真号码、电子邮件地址等联系信息进行送达。"
  "<h2>11. 法律适用</h2>"
  "<h3>11.1</h3>"
  "本协议的订立、执行和解释及争议的解决均应适用中华人民共和国大陆地区法律。"
  "<h3>11.2</h3>"
  "如双方就本协议内容或其执行发生任何争议，双方应尽量友好协商解决；协商不成时，任何一方均可向当地人民院提起诉讼。"
  "<h2>12. 其他规定</h2>"
  "<h3>12.1</h3>"
  "如本协议中的任何条款无论因何种原因完全或部分无效或不具有执行力，本协议的其余条款仍应有效并且有约束力。"
  "<h3>12.2</h3>"
  "本协议中的标题仅为方便而设，在解释本协议时应被忽略，不能作为本协议条款解释的依据。"
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""
    ""

);


